<!DOCTYPE html>
<html lang="he">
<head>
  <meta charset="UTF-8" />
  <title>בחינה</title>
  <link rel="stylesheet" href="script.css">
</head>
<body>
  <div id="intro">
    <h1>הוראות הבחינה</h1>
    <p>היי! הניסוי נועד לבדוק השפעות של דדליין גלוי על ביצועים במשימות. כל הניסוי יערוך 10-15 דקות בערך.
הניסוי כולל שתי בחינות שכוללות 60 תרגילים כל אחת שאמורים להיות ברמה של כיתה ג בחשבון. כל בחינה תיקח 5 דקות בדיוק. אשמח אם תבצעו את שתי הבחינות אחת אחרי השנייה. 
אמורים לפתור אותן באמצעות דף ועיפרון בלבד, ללא מחשבון.
תודה רבה על העזרה!
תמר
</p>
<div class="input-row">
  <label for="nameInput">שם הנבחנ/ת:</label>
  <input type="text" id="nameInput" />
</div><br /><br />
    <button onclick="startTest()">התחל</button>
  </div>

  <div id="test" class="hidden">
    <div class="timer" id="timer"></div>
    <form id="testForm"></form>
    <div class="center">
      <button onclick="submitTest(event)">סיים מבחן</button>
    </div>
  </div>

  <div id="between" class="hidden">
    <h2>המבחן הסתיים</h2>
    <button onclick="startSecondTest()">המשך לבחינה השנייה</button>
  </div>

  <div id="done" class="hidden">
  <h2>תודה רבה!</h2>
  <p>
    הקובץ עם תוצאות המבחן ירד למחשב שלך. <br />
    נא לשלוח אותו לכתובת: 
 <strong>tamarnnn@gmail.com</strong><br />
    ניתן לשלוח אותו במייל תחת הכותרת: "תוצאות מבחן" או פשוט לצרף כקובץ.<br /><br />
    תודה רבה על ההשתתפות!
  </p>
  <button onclick="downloadResults()">הורד קובץ תוצאות</button>
</div>



  <script>
const questions1 = [
  "3+4", "12-5", "6*3", "8:2", "7+6", "20-11", "9*2", "16:4", "5+5", "14-7",
  "4*4", "18:3", "10+9", "17-8", "7*5", "21:7", "6+6", "13-5", "8*2", "24:6",
  "11+4", "15-9", "3*7", "20:5", "9+1", "16-10", "6*6", "18:2", "8+3", "19-12",
  "5*5", "25:5", "2+6", "10-3", "7*3", "27:3", "4+9", "11-4", "3*6", "12:4",
  "6+7", "13-6", "8*4", "32:8", "5+8", "14-6", "9*3", "18:6", "7+2", "17-9",
  "4*5", "30:5", "10+7", "21-13", "6*2", "16:2", "3+5", "9-4", "5*6", "36:6",
  "2+9", "12-8", "8*5", "40:8", "4+7", "15-6", "7*4", "28:4", "9+6", "20-11",
  "6*3", "18:6"
];

const questions2 = [
  "4+3", "13-6", "7*2", "9:3", "6+5", "21-10", "8*2", "12:4", "3+6", "15-8",
  "5*3", "20:4", "11+5", "18-9", "6*4", "24:6", "7+4", "14-5", "4*6", "30:6",
  "10+3", "16-7", "3*5", "25:5", "9+2", "13-6", "8*3", "27:3", "6+8", "19-11",
  "7*6", "36:6", "2+7", "11-3", "5*4", "20:5", "8+3", "17-9", "6*5", "30:6",
  "3+7", "12-5", "4*7", "28:4", "9+4", "22-13", "7*3", "21:7", "5+6", "14-9",
  "6*2", "18:3", "8+2", "16-10", "3*6", "36:6", "4+5", "13-4", "7*2", "14:2",
  "10+6", "19-8", "6*3", "18:2", "2+8", "15-7", "5*5", "25:5", "9+3", "17-8",
  "8*4", "32:4"
];

const correctAnswers = [
  7, 7, 18, 4, 13, 9, 18, 4, 10, 7,
  16, 6, 19, 9, 35, 3, 12, 8, 16, 4,
  15, 6, 21, 4, 10, 6, 36, 9, 11, 7,
  25, 5, 8, 7, 21, 9, 13, 7, 18, 3,
  13, 7, 32, 4, 13, 8, 27, 3, 9, 8,
  20, 6, 17, 8, 12, 8, 8, 5, 30, 6,
  11, 4, 40, 5, 11, 9, 28, 7, 15, 9,
  18, 3,
  7, 7, 14, 3, 11, 11, 16, 3, 9, 7,
  15, 5, 16, 9, 24, 4, 11, 9, 24, 5,
  13, 9, 15, 5, 11, 7, 24, 9, 14, 8,
  42, 6, 9, 8, 20, 4, 11, 8, 30, 5,
  10, 7, 28, 7, 13, 9, 21, 3, 11, 5,
  12, 6, 10, 6, 18, 6, 9, 9, 14, 7,
  16, 11, 18, 9, 10, 8, 25, 5, 12, 9,
  32, 8
];

    let results = {
      name: '',
      startTime: '',
      endTime: '',
      tests: []
    };

    let testIndex = 0;
    let startTime, interval, visibleTimer;

    function startTest() {
      const name = document.getElementById('nameInput').value.trim();
      if (!name) return alert("נא למלא שם");
      results.name = name;
      document.getElementById('intro').classList.add('hidden');
      testIndex = Math.random() < 0.5 ? 0 : 1;
      runTest();
    }

    function runTest() {
      const isVisible = (testIndex === 0);
      const questions = testIndex === 0 ? questions1 : questions2;
      const form = document.getElementById('testForm');
      form.innerHTML = '';
      document.getElementById('test').classList.remove('hidden');
      const timerEl = document.getElementById('timer');
      if (!isVisible) timerEl.classList.add('hidden');
      else timerEl.classList.remove('hidden');
      
      questions.forEach((q, i) => {
        form.innerHTML += `
          <div class="question">
            <label>${i + 1}. ${q}<br />
              <textarea name="q${i}"></textarea>
            </label>
          </div>`;
      });

      startTime = Date.now();
      let seconds = 300;
      visibleTimer = isVisible;

      interval = setInterval(() => {
        seconds--;
        if (visibleTimer) timerEl.textContent = `זמן שנותר: ${Math.floor(seconds/60)}:${(seconds%60).toString().padStart(2,'0')}`;
        if (seconds <= 0) {
          clearInterval(interval);
          submitTest();
        }
      }, 1000);
    }

    function submitTest(event) {
      if (event) event.preventDefault();
      clearInterval(interval);
      const formData = new FormData(document.getElementById('testForm'));
      const answers = [];
      const questions = testIndex === 0 ? questions1 : questions2;
      const offset = testIndex === 0 ? 0 : questions1.length;

      for (let i = 0; i < questions.length; i++) {
        const ans = formData.get(`q${i}`)?.trim() || '';
        const correct = parseFloat(correctAnswers[i + offset].toFixed(2));
        const given = parseFloat(ans);
        let status = 'לא הוגש';
        if (ans) {
          status = Math.abs(correct - given) < 0.1 ? 'נכון' : 'שגוי';
        }
        answers.push({ question: questions[i], answer: ans, correct, status });
      }

      results.tests.push({
        type: testIndex === 0 ? 'טיימר גלוי' : 'טיימר נסתר',
        start: new Date(startTime).toISOString(),
        end: new Date().toISOString(),
        answers
      });

      document.getElementById('test').classList.add('hidden');
      if (results.tests.length === 1) {
        testIndex = testIndex === 0 ? 1 : 0;
        document.getElementById('between').classList.remove('hidden');
      } else {
        document.getElementById('done').classList.remove('hidden');
      }
    }

    function startSecondTest() {
      document.getElementById('between').classList.add('hidden');
      runTest();
    }

function downloadResults() {
  let text = `תוצאות מבחן\n===============\n`;
  text += `שם הנבחנ/ת: ${results.name}\n`;
  text += `שעת התחלה: ${results.tests[0]?.start}\n`;
  text += `שעת סיום: ${results.tests[1]?.end}\n\n`;

  results.tests.forEach((test, index) => {
    text += `בחינה ${index + 1} (${test.type})\n`;
    text += `------------------------\n`;
    test.answers.forEach((ans, i) => {
      text += `${i + 1}. ${ans.question} => תשובה: ${ans.answer || '---'}, תקינות: ${ans.status}\n`;
    });
    text += `\n`;
  });

 text += `נא לשלוח קובץ זה לכתובת: tamarnnn@gmail.com\n`;

  const blob = new Blob([text], { type: 'text/plain;charset=utf-8' });
  const link = document.createElement('a');
  link.href = URL.createObjectURL(blob);
  link.download = `תוצאות_${results.name || 'ללא_שם'}.txt`;
  link.click();

  alert("הקובץ ירד למחשב שלך. נא לשלוח אותו לכתובת tamar.research@gmail.com");
}


  </script>
</body>
</html>
